<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Intravenous by RoyJacobs</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/RoyJacobs/intravenous">View On GitHub</a></li>
          <li class="downloads"><a href="https://raw.github.com/RoyJacobs/intravenous/master/build/output/intravenous-latest.debug.js">DEBUG</a></li>
          <li class="downloads"><a href="https://raw.github.com/RoyJacobs/intravenous/master/build/output/intravenous-latest.js">RELEASE (2.7kb)</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>Intravenous</h1>
          <p>A lightweight inversion of control container for Javascript.</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/RoyJacobs">RoyJacobs</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="http://twitter.com/#!/michigangraham">mattgraham</a></span>
        </div>

        <h1>Intravenous</h1>

<hr><p>A lightweight zero-dependency <a href="http://martinfowler.com/articles/injection.html">inversion of control container</a> for Javascript.</p>

<h3>What? Why?</h3>

<p>If you are building complex applications it can become very difficult to manage object lifetimes and dependencies. For instance, if you're building a UI you may want to create a dialog. The dialog's model may have dependencies on a logger, Growlesque notification thing, etc. It'll probably also contain some sub-models to display inside the dialog. You need to track all these dependencies and when the dialog closes you want to dispose some of the models (but not all, since the logger is probably a singleton) and so on... Complex! Unless you use an IoC container like this one.</p>

<p>With <em>Intravenous</em> you create a <em>container</em> and tell this container which services are available in your system. Then, when you have class that wants to use these services you simply list them as dependencies. You tell the container to create an instance of your class and all dependencies will be automatically resolved (even if your depedencies have dependencies of their own).</p>

<p>You can also create something called a <em>nested container</em>. In case of the dialog sample you would use this nested container to create all the view models that are only relevant during the dialog's lifetime. When the dialog closes, you can dispose the nested container and automatically all of the objects created by that container will be disposed as well. Still sounds complex? Read on!</p>

<h3>How do I include it?</h3>

<p>It can be loaded as an CommonJS/Node.JS or AMD module. If you don't have either, it will be available as <code>window.intravenous</code>. It has no dependencies on other libraries.</p>

<h3>How do I use it?</h3>

<ol>
<li>
<p>Create a container like this:</p>

<div class="highlight">
<pre><span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">intravenous</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
</pre>
</div>
</li>
<li>
<p>Next, register some services (can be a constructor function or just an object):</p>

<div class="highlight">
<pre><span class="nx">container</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">"logger"</span><span class="p">,</span> <span class="nx">loggerClass</span><span class="p">);</span>
<span class="nx">container</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">"someGlobalData"</span><span class="p">,</span> <span class="p">{</span> <span class="nx">data</span><span class="o">:</span> <span class="s2">"hello"</span> <span class="p">});</span>
</pre>
</div>
</li>
<li>
<p>Then, define a class and its dependencies</p>

<div class="highlight">
<pre><span class="kd">var</span> <span class="nx">myClass</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">logger</span><span class="p">,</span> <span class="nx">someGlobalData</span><span class="p">)</span> <span class="p">{</span>
<span class="cm">/* use logger here */</span>
<span class="p">};</span>
<span class="nx">myClass</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"logger"</span><span class="p">,</span> <span class="s2">"someGlobalData"</span><span class="p">;</span>
<span class="nx">container</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">"myClass"</span><span class="p">,</span> <span class="nx">myClass</span><span class="p">);</span>
</pre>
</div>
</li>
<li>
<p>Finally, get an instance to this class through the container:</p>

<div class="highlight">
<pre><span class="kd">var</span> <span class="nx">myInstance</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"myClass"</span><span class="p">);</span>
</pre>
</div>
</li>
</ol><p>You will now have an instance of <code>myClass</code> with all its dependencies resolved.</p>

<h3>What if a service doesn't exist?</h3>

<p>It will throw an exception. Alternatively, you can specify optional (or nullable) dependencies by using the <code>?</code> suffix, like so:</p>

<div class="highlight">
<pre><span class="nx">myClass</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"logger"</span><span class="p">,</span> <span class="s2">"optionalDependency?"</span><span class="p">];</span>
</pre>
</div>


<p>In this case <code>optionalDependency</code> will be injected as <code>null</code> if it doesn't exist.</p>

<h3>How can I control object disposal?</h3>

<p>Pass in an <code>onDispose</code> handler when you create the container:</p>

<div class="highlight">
<pre><span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">intravenous</span><span class="p">.</span><span class="nx">create</span><span class="p">({</span>
  <span class="nx">onDispose</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">serviceName</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">obj</span><span class="p">.</span><span class="nx">yourDisposeFunction</span><span class="p">();</span>
  <span class="p">}</span>
<span class="p">});</span>
</pre>
</div>


<p>Now, whenever you are done with your container, call <code>dispose</code> on the container and it will call your <code>onDispose</code> callback for every object that needs to be disposed.</p>

<h3>What if I want to dispose only parts of the container, instead of everything?</h3>

<p>Use a nested container and dispose that instead:</p>

<div class="highlight">
<pre><span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nx">intravenous</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="cm">/* onDispose handler here */</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">nested</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">myInstance</span> <span class="o">=</span> <span class="nx">nested</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"myClass"</span><span class="p">);</span>
<span class="nx">nested</span><span class="p">.</span><span class="nx">dispose</span><span class="p">();</span>
</pre>
</div>


<p>You can also register additional services on the nested container. They will override services registered on the parent container.</p>

<p>Creating a nested container is very lightweight so it's highly recommended to use them.</p>

<p>Please note that <code>container.create()</code> is not the same as <code>intravenous.create()</code>. The first creates a nested container, the second creates a completely new intravenous container. Typically in your application you will only need a single intravenous container.</p>

<h3>But how can I get access to the main intravenous container?</h3>

<p>Take a dependency on the service called <code>container</code>, like so:</p>

<div class="highlight">
<pre><span class="kd">var</span> <span class="nx">myClass</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">container</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">nested</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>
<span class="p">}</span>
<span class="nx">myClass</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"container"</span><span class="p">,</span> <span class="cm">/* ... other dependencies */</span><span class="p">];</span>
</pre>
</div>


<h3>How can I control the lifecycle of a service?</h3>

<p>When registering a service using <code>register</code> it will default to the <code>perRequest</code> lifecycle. There are a number of different lifecycles you can use, though. They are listed below.</p>

<p>Let's say you have a service called <code>foo</code> and you are resolving an object <code>bar</code> that needs to resolve a large object graph to satisfy all its dependencies. It may mean <code>foo</code> is required in a lot of different places.</p>

<p>The available lifecycles:</p>

<ol>
<li><p><code>perRequest</code>: Regardless of how many times <code>foo</code> is required in the object graph, it is only created once. The next call to <code>container.get</code> will create a new <code>foo</code>, though.</p></li>
<li><p><code>unique</code>: Every time <code>foo</code> is required in the object graph, a new instance is created.</p></li>
<li><p><code>singleton</code>: As long as the container is not disposed, <code>foo</code> will only be created once. It will also be reused across multiple calls to <code>container.get</code>.</p></li>
</ol><p>The lifecycle is specified as the third argument to <code>register</code>:</p>

<div class="highlight">
<pre><span class="nx">container</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">"logger"</span><span class="p">,</span> <span class="nx">loggerClass</span><span class="p">,</span> <span class="s2">"singleton"</span><span class="p">);</span>
</pre>
</div>


<h3>How can I specify additional arguments?</h3>

<p>When you want to pass additional to your class, simply add them to the <code>container.get</code> call:</p>

<div class="highlight">
<pre><span class="kd">var</span> <span class="nx">myClass</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">logger</span><span class="p">,</span> <span class="nx">extra</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">alert</span><span class="p">(</span><span class="nx">extra</span><span class="p">);</span>
<span class="p">};</span>
<span class="nx">myClass</span><span class="p">.</span><span class="nx">$inject</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"logger"</span><span class="p">];</span>
<span class="nx">container</span><span class="p">.</span><span class="nx">register</span><span class="p">(</span><span class="s2">"myClass"</span><span class="p">,</span> <span class="nx">myClass</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">myInstance</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">"myClass"</span><span class="p">,</span> <span class="s2">"hello!"</span><span class="p">);</span>
</pre>
</div>


<p>This example will alert <code>hello!</code>.</p>

<h3>Can I also create instances of services I haven't yet registered?</h3>

<p>No, not yet.</p>

<h3>Where did you get inspiration from?</h3>

<p>The <code>$inject</code> syntax was inspired by <a href="http://angularjs.org/">AngularJS</a>. The nested container was a good idea pilfered from <a href="http://www.structuremap.net">StructureMap</a>.</p>

<h3>What's the license?</h3>

<p><a href="http://www.opensource.org/licenses/mit-license.php">MIT</a>.</p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-31340321-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>