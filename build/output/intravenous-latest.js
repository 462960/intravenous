// Intravenous JavaScript library v0.1.1-beta
// (c) Roy Jacobs
// License: MIT (http://www.opensource.org/licenses/mit-license.php)

(function(window,undefined){
var j=!0,l=null;function p(h){function q(n,o){for(var i=n.split("."),m=h,k=0;k<i.length-1;k++)m=m[i[k]];m[i[i.length-1]]=o}h="undefined"!==typeof h?h:{};h.version="0.1.1-beta";q("version",h.version);(function(){function n(a,b,d){for(var c=o(a,b),b=c.key,c=c.data,f,g=a;g&&!(f=g.i[b]);)g=g.parent;if(c&&c.s){var e=c.s(a,b,f);if(e.h)return e.data}if(!g)throw Error("Unknown dependency: "+b);if(c&&c.u&&(e=c.u(a,b,f),e.h))return e.data;if(e=a.c[f.k].get(b))return e;if(f.value instanceof Function){e=f.value.$inject;b=[];
if(e instanceof Array){c=0;for(g=e.length;c<g;c++)b.push(n(a,e[c],[]))}c=function(){};c.prototype=f.value.prototype;e=new c;c=0;for(g=d.length;c<g;c++)b.push(d[c]);f.value.apply(e,b)}else e=f.value;a.c[f.k].set(new u(f,e));return e}function o(a,b){for(var d in a.t)for(var c=a.t[d],f=0,g=c.suffixes.length;f<g;f++){var e=c.suffixes[f];if(-1!==b.indexOf(e,b.length-e.length))return{data:c,key:b.slice(0,b.length-e.length)}}return{data:l,key:b}}function i(a,b){this.i={};this.parent=b;this.c={perRequest:new r(this),
singleton:new s(this,b?b.c.singleton:l),unique:new t(this)};this.children=[];this.options=a=a||{};this.m("container",this);this.dispose=this.d;this.get=this.get;this.register=this.m}function m(a,b){this.a=a;this.key=b;this.dispose=this.d;this.get=this.get;this.use=this.j}function k(a,b){this.a=a.create();this.key=b;this.dispose=this.d;this.get=this.get;this.use=this.j}function t(a){this.a=a;this.b=[]}function s(a,b){this.a=a;this.b=[];this.parent=b}function r(a){this.a=a;this.b=[];this.l={};this.g=
0;this.p={};this.q=[]}function u(a,b){this.e=a;this.f=b}function v(a,b,d,c){this.key=a;this.a=b;this.value=d;this.k=c}r.prototype={get:function(a){for(var b=0,d=this.b.length;b<d;b++){var c=this.b[b];if(c.e.key===a&&c.g===this.g){if(!c.f)break;this.set(c);return c.f}}this.q.push(a);if(this.p[a])throw Error("Circular reference: "+this.q.join(" --\> "));this.p[a]=j;return l},set:function(a){this.b.push(a);this.l[a.e.key]=this.l[a.e.key]++||1;a.g=this.g},n:function(a){return!--this.l[a.e.key]},o:function(){this.g++;
this.p={};this.q=[]}};s.prototype={get:function(a){for(var b=0,d=this.b.length;b<d;b++){var c=this.b[b];if(c.e.key===a){if(!c.f)break;this.set(c);return c.f}}return this.parent?this.parent.get(a):l},set:function(a){this.b.push(a)},n:function(a){return a.e.a===this.a},o:function(){}};t.prototype={get:function(){return l},set:function(a){this.b.push(a)},n:function(){return j},o:function(){}};k.prototype={get:function(){var a=Array.prototype.slice.call(arguments);a.unshift(this.key);a=this.a.get.apply(this.a,
a);a.r=this;return a},j:function(a,b,d){this.a.m(a,b,d);return this},d:function(){this.a.d()}};m.prototype={get:function(){var a=new k(this.a,this.key);return a.get.apply(a,arguments)},j:function(a,b,d){return(new k(this.a,this.key)).j(a,b,d)},d:function(a){a.r.d();delete a.r}};i.prototype={t:{w:{suffixes:["?"],s:function(a,b,d){return d?{h:!1}:{h:j,data:l}}},factory:{suffixes:["Factory","!"],u:function(a,b){return{h:j,data:new m(a,b)}}}},m:function(a,b,d){if(o(this,a).data)throw Error("Cannot register dependency: "+
a);!d&&this.i[a]?this.i[a].value=b:this.i[a]=new v(a,this,b,d||"perRequest")},get:function(a){for(var b in this.c)this.c.hasOwnProperty(b)&&this.c[b].o(a);b=Array.prototype.slice.call(arguments).slice(1);for(var d=this,c;d&&(c=n(d,a,b))===l;)d=d.parent;return c},d:function(){for(var a;a=this.children.pop();)a.d();for(var b=this.v();a=b.pop();)if(this.c[a.e.k].n(a)&&this.options.onDispose)this.options.onDispose(a.f,a.e.key);return j},create:function(a){a=a||{};a.onDispose=a.onDispose||this.options.onDispose;
a=new i(a,this);this.children.push(a);return a},v:function(){var a=[],b;for(b in this.c)this.c.hasOwnProperty(b)&&(a=a.concat(this.c[b].b));return a}};h.create=function(a){return new i(a)};q("create",h.create)})()}"function"===typeof require&&"object"===typeof exports&&"object"===typeof module?p(module.exports||exports):"function"===typeof define&&define.amd?define(["exports"],p):p(window.intravenous={});j;
})(typeof window !== "undefined" ? window : global);
